<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Mental Warehouse</title>
  <link rel="stylesheet" href="css/styles.css">
  <meta name="theme-color" content="#fff">
</head>
<body>
  <header class="topbar">
    <div class="container">
      <h1 class="brand">The Mental Warehouse</h1>
      <nav class="nav">
        <a href="index.html" class="active">Home</a>
        <a href="movies.html">Movies</a>
        <a href="journal.html">Journal</a>
        <a href="games.html">Games</a>
        <a href="rules.html">Rules</a>
        <a href="misc.html">Notes</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="dashboard">
      <h2>Dashboard</h2>

      <div class="cards-grid">
        <a class="card" href="movies.html" id="card-movies">
          <div class="card-title">Movies Log</div>
          <div class="card-preview"><span class="badge" id="movies-count">0</span> movies</div>
        </a>

        <a class="card" href="journal.html" id="card-journal">
          <div class="card-title">Journal</div>
          <div class="card-preview"><span class="badge" id="journal-count">0</span> entries</div>
        </a>

        <a class="card" href="rules.html" id="card-rules">
          <div class="card-title">Rules</div>
          <div class="card-preview"><span class="badge" id="rules-count">0</span> rules</div>
        </a>

        <a class="card" href="misc.html" id="card-misc">
          <div class="card-title">Notes</div>
          <div class="card-preview"><span class="badge" id="misc-count">0</span> notes</div>
        </a>

        <a class="card" href="games.html" id="card-games">
          <div class="card-title">Games</div>
          <div class="card-preview"><span class="badge">‚Äî</span> two-player</div>
        </a>
      </div>

      <div id="dev-controls" style="display:none; margin-top:2rem; text-align:center;">
        <button id="save-locally-btn" style="padding:0.75rem 1.5rem; font-size:1rem; background:var(--palette-3); color:white; border:none; border-radius:0.5rem; cursor:pointer; font-weight:bold;">
          üíæ Save Locally
        </button>
        <p id="save-status" style="margin-top:0.5rem; font-size:0.9rem; color:var(--palette-3);"></p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <small>¬© <span id="year"></span> The Mental Warehouse ‚Äî a tiny creative operations hub.</small>
    </div>
  </footer>

  <script src="js/data.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/init.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    document.addEventListener('DOMContentLoaded', async ()=>{
      const movies = await storage.get('movies') || [];
      const journal = await storage.get('journal') || [];
      const rules = await storage.get('rules') || [];
      const misc = await storage.get('misc') || [];
      document.getElementById('movies-count').textContent = movies.length;
      document.getElementById('journal-count').textContent = journal.length;
      document.getElementById('rules-count').textContent = rules.length;
      document.getElementById('misc-count').textContent = misc.length;

      // Show Save Locally button only in dev mode
      if(window.isDev){
        document.getElementById('dev-controls').style.display = 'block';
        document.getElementById('save-locally-btn').addEventListener('click', async ()=>{
          try{
            document.getElementById('save-locally-btn').disabled = true;
            document.getElementById('save-status').textContent = 'Saving...';
            await storage.saveAll();
            document.getElementById('save-status').textContent = '‚úÖ Saved to disk! Changes will reflect on index.html after refresh.';
            document.getElementById('save-locally-btn').disabled = false;
          }catch(e){
            document.getElementById('save-status').textContent = '‚ùå Save failed: ' + e.message;
            document.getElementById('save-locally-btn').disabled = false;
          }
        });
      }
    });
  </script>
  </script>
</body>
</html>
